<html>

<style>
    /* html {
        text-align: center;
        font-size: 16px;
    }

    div {
        padding: 1rem;
    }

    #input {
        font-size: 16px;
    }

    p {
        font-size: 16px;
    } */
</style>
<link href="/assets/jsonViewer.css" rel="stylesheet" type="text/css" />
<link href="/assets/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/assets/jsonViewer.js"></script>
<script>

    const numLogsToRead = 10
    const socket = new WebSocket("ws://" + window.location.hostname + ":7777/liveLogs");

    socket.onopen = function () {
        console.log('ws connected')
    };

    socket.onmessage = async function (e) {
        let json
        if (typeof e.data.text !== "undefined") {
            json = JSON.parse(await e.data.text())
        } else {
            json = JSON.parse(e.data)

        }
        const JsonData = JSON.parse(json.data)
        console.log(json.time, JSON.parse(json.data))
        console.log(JsonData.tag)
        console.log(typeof getElByClass("tag:" + JsonData.tag))

        let container
        if (typeof JsonData.tag !== "undefined") {
            if (typeof getElByClass("tag:" + JsonData.tag) === 'undefined') {
                container = createLogWindow(JsonData.tag)
            } else {
                container = getElByClass("tag:" + JsonData.tag)
            }
        } else {
            container = getElByClass("tag:")
        }
        new JsonViewer({
            container: container,
            dateTime: getDateTime(json.time),
            data: json.data,
            theme: 'dark',
            expand: true
        });

    }

    function getDateTime(nanotime) {
        var d = new Date(Math.round(nanotime / 1000000));
        return d.getDate() + '/' + (d.getMonth()) + '/' + d.getFullYear() + " " + d.getHours() + ':' + d.getMinutes() + ':' + d.getSeconds() + ':' + d.getMilliseconds()
    };


    function createLogWindow(tag) {
        const logWindow = document.createElement("div")
        logWindow.classList.add("logWindow")
        logWindow.classList.add("tag:" + tag)
        const tagName = document.createElement("div")
        tagName.classList.add("tagName")
        tagName.appendChild(document.createTextNode(tag))
        logWindow.appendChild(tagName)
        const maximize = document.createElement("div")
        maximize.classList.add("maximize")
        maximize.addEventListener('click', event => {
            console.log(logWindow.classList)
            if (logWindow.classList.contains('maxed')) {
                logWindow.classList.remove("maxed")
            } else {
                logWindow.classList.add("maxed")
            }
        });
        tagName.appendChild(maximize)


        getElByClass("logsContainer").appendChild(logWindow)
        return logWindow
    }

    function getElByClass(classname) {
        return document.getElementsByClassName(classname)[0]
    }


</script>


<body>

    <div class="logsContainer">

    </div>



    <script>
        createLogWindow("")
    </script>


</body>


</html>